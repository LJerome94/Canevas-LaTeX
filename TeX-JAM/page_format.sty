%-------------------------------------------------------------------------------
\usepackage{amsmath} % Math formating
\usepackage{amsthm} % Proof and theorem formating.

% Prevents font related errors.
\newcommand\hmmax{0}
\newcommand\bmmax{0}

\usepackage[french]{babel} % French labeling. TODO English support
\usepackage{graphicx} % More options for figures.
\usepackage{float} % Better handling of figures and table.
\usepackage{xcolor} % More colors.
%\usepackage[x11names,svgnames]{xcolor} % Commented out because of clash with pgfplots.
\usepackage{url} % Url formating.
\usepackage{enumerate} % More options for lists.
\usepackage{enumitem} % Lists customization.
\usepackage{setspace} % Line spacing.
\usepackage{geometry} % More flexible display options
\usepackage{wrapfig} % Figure formating.
% %
% \let\saveboldmath\boldmath % Fix mathcal clashes
% \usepackage[bitstream-charter]{mathdesign} % Change the default font.
% \let\boldmath\saveboldmath % Fix mathcal clashes
% \usepackage{bm} % Any character in bold.
% %
% \let\circledS\undefined % Fix random clash
% \usepackage[T1]{fontenc} % Choose font encoding
% % Fix mathcal clashes
% \DeclareSymbolFont{cmsymbols}{OMS}{cmsy}{m}{n}
% \SetSymbolFont{cmsymbols}{bold}{OMS}{cmsy}{b}{n}
% \DeclareSymbolFontAlphabet{\mathcal}{cmsymbols}
% %
\usepackage[utf8]{inputenc} % Allows more character directly in-code.
\usepackage{layout} % 
\usepackage{makeidx} % Allows to makes indexes.
\usepackage{subfiles} % Allows to render other .tex files in 'MAIN'.
\usepackage{fancyhdr} % Formats header and footer of page.
\setlength {\marginparwidth }{2cm} % Prevents warning from the package todonotes.
\usepackage[color=chaptercolorback, size=tiny]{todonotes} % Allows to-do notes.
%-------------------------------------------------------------------------------


%%%%%%%%%%%%%
% Formating %
%%%%%%%%%%%%%

% Lists -----------------------
\AtBeginDocument{\def\labelitemi{-}}


% Links -----------------------
\usepackage{hyperref} 
\hypersetup{ 
     colorlinks=true,
     breaklinks=true,
     urlcolor= blue,  
     linkcolor= chaptercolor,
     bookmarksopen=true,
     citecolor=chaptercolor
}


% General formating -----------------------
\usepackage[font=small]{caption}
\usepackage{subcaption}

\tolerance=500

\renewcommand{\normalsize}{\fontsize{10pt}{11pt}\selectfont} 
\setlength{\textwidth}{6.5in} 
\setlength{\textheight}{9in}
\setlength{\paperwidth}{8.5in} 
\setlength{\paperheight}{11in}
\setlength{\itemindent}{1cm}

\oddsidemargin = 0.0 in
\evensidemargin = 0.0 in
\topmargin = -0.5 in
%\headheight = 16pt
%\headsep = 0.2in % used to be zero
\headsep = 0.3in
\parindent = 0cm

\captionsetup{justification=centering}

\newcommand{\blankpage}{\newpage\thispagestyle{plain}\pagenumbering{gobble}~\clearpage\pagenumbering{arabic}
} % Command to add blankpage.


% Tableaux -----------------------
\usepackage{array} % Table manipulation.
\usepackage{multirow} % Allows to fuse rows-wise.
\usepackage{multicol} % Allows to fuse cells column-wise.
\usepackage{booktabs} % More table personalisation.

\def\frenchtablename{Tableau} % French table name.

\newcolumntype{C}{>{$\displaystyle}c<{$}} % Math-mode columns types.
\newcolumntype{L}{>{$\displaystyle}l<{$}} %
\newcolumntype{R}{>{$\displaystyle}r<{$}} %
\renewcommand{\arraystretch}{1.5}
\usepackage{dcolumn} % Decimal point alignment.


% Title formats -----------------------
\usepackage[calcwidth]{titlesec} % Titles customization.

% Default color - Edit these in 'MAIN.tex'.
\colorlet{chaptercolor}{black}
\colorlet{chaptercolorback}{black!10!white}

\renewcommand*{\thesection}{\arabic{section}} % Section number format.
\renewcommand*{\thesubsection}{\Alph{subsection}} % Subsection number format.
\renewcommand*{\thesubsubsection}{\Alph{subsection}.\roman{subsubsection}} % Subsubection number format.

% Section format. https://latex.org/forum/viewtopic.php?t=275211
\titleformat{\section}
    {\penalty-2000{\color{chaptercolor}\titlerule[2pt]}\Large\bfseries\vspace{4pt}} % Format
    {\fcolorbox{chaptercolor}{chaptercolorback}{\thesection}\hspace{-5pt}} % Label
    {1em} % Sep
    {} % Before code
    [] % After code


\titleformat{\subsection}{\penalty-2000\large\bfseries}{{\thesubsection}\hspace{-5pt}}{1em}{}[] % Subsection format.

\titleformat{\subsubsection}{\penalty-2000\vspace{0pt plus 10pt}\bfseries}{\thesubsubsection}{1em}{}[] % Subsubsection format.


% Figures -----------------------
\newcommand{\Figure}[4]{ % Allow to quickly add figures.
\begin{figure}[H]
    \centering
    \includegraphics[width=#2\linewidth]{#1}
    \caption{#3}
    \label{#4}
\end{figure}
} % #1 path-to-file, #2 size, #3 caption, #4 label


% Color text -----------------------
\newcommand{\red}[1]{{\color{red} #1}}
\newcommand{\purple}[1]{{\color{purple} #1}}
\newcommand{\blue}[1]{{\color{blue} #1}}
\newcommand{\orange}[1]{{\color{orange} #1}}
\newcommand{\green}[1]{{\color{Green} #1}}
\newcommand{\yellow}[1]{{\color{yellow} #1}}
\newcommand{\pink}[1]{{\color{pink} #1}}
\newcommand{\gray}[1]{{\color{gray} #1}}
\newcommand{\brown}[1]{{\color{brown} #1}}


% Title page -----------------------
\newcommand{\university}[1]{\renewcommand{\university}{#1}} % University
\newcommand{\faculty}[1]{\renewcommand{\faculty}{#1}} % Faculty
\newcommand{\departement}[1]{\renewcommand{\departement}{#1}} % Departement

%\makeatletter
\def\mytitle{\@title}
\def\maketitlepage{
	\begin{titlepage}
	\begin{singlespace}
	\begin{center}
		\@author
		\vfill
		\textsc{\color{chaptercolor}\Large \@title}
		\vfill
		Presenté à\\
		\@teacher\\
		pour le cours\\
		\textit{\@class}
		\vfill
		\university\\
		\faculty\\
		\departement\\
		\@date
	\end{center}
	\end{singlespace}
	\end{titlepage}
}
\def\teacher#1{\def\@teacher{#1}}
\def\class#1{\def\@class{#1}}
%\makeatother

% Table of contents ----------------------
\newcommand{\maketableofcontents}{
    \thispagestyle{plain} % TODO Changer ceci
    {\hypersetup{ 
     linkcolor= black,
    }
    \tableofcontents
    }
    \newpage
}

% References ----------------------
\newcommand{\makereferences}{
\newpage
\thispagestyle{plain}
\nocite{*}
\printbibliography
}

% Equation boxes  ----------------------
\usepackage{tcolorbox}
\tcbuselibrary{theorems}

\tcbset{highlight math style={colframe=chaptercolor,colback=white,arc=4pt,boxrule=1pt,sharp corners}
}

% Use a colored box for 'boxed'
\renewcommand{\boxed}[1]{\tcbhighmath{#1}}

% Big box around paragraph
\newtcolorbox[auto counter,number within=section]{definitionbox}[1][]{colback=white,colframe=chaptercolor,fonttitle=\bfseries,sharp corners,#1}
\newcommand{\bigbox}[1]{
    \begin{definitionbox}
#1
\end{definitionbox}
}

\renewcommand\thefootnote{\textcolor{chaptercolor}{\arabic{footnote}}} % Footnote index color

%\renewcommand\footnoterule{\kern-3pt {\color{chaptercolor}\hrule width 2in} \kern 2.6pt} % Footnote line.

% Fonts
\usepackage{charter}
\usepackage[charter,cal=cmcal]{mathdesign}

% Headers
% \pagestyle{fancy}
% \fancyhf{}
% \fancyhead[ER]{\color{chaptercolor}\textit\leftmark}
% \fancyhead[OL]{\color{chaptercolor}\textit\mytitle}
% \fancyfoot[C]{\thepage} % Page number centered
% \renewcommand{\headrulewidth}{0pt}
\fancypagestyle{normal}{%
  \fancyhf{}%
  \renewcommand{\headrulewidth}{0pt}%
  \fancyhead[LO]{\color{chaptercolor}\small\textit\mytitle} %
  \fancyhead[RE]{\color{chaptercolor}\small\textit\leftmark} %
  \fancyfoot[C]{\thepage} % Page number centered
}
\pagestyle{normal}
\renewcommand{\sectionmark}[1]{\markboth{\text{\thesection.}~ #1}{}}
